---
title: "4.Gene_expressions_analysis -  Analyzing differences between field and 
lab gene expression data"
author: "Fay Webster"
date: '2022-07-18'
geometry: margin=2cm
output:
  pdf_document: default
  theme: journal
  toc: yes
  toc_float: yes
  html_document: null
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Aims:
- Compare immune gene expression between lab and field data
- How do eimeria infections affect the expression of various immune genes?
- Does the expression vary between lab and field data? 

# load libraries
```{r}
library(ggplot2)
library(tidyverse)
```


# Import data:
Here, we have the experimental / field data, inlcuding imputed data

```{r}
lab <- read.csv("output_data/gene_expression/data_products/lab_imputed_gene_expression.csv")
field <- read.csv("output_data/gene_expression/data_products/field_imputed_gene_expression.csv")
```

# Selecting genes
```{r}
# vectors for selecting gene columns 
Genes_lab <- c("IFNy", "CXCR3_bio", "IL.6", "IL.10", "IL.13", "IL1RN", "CASP1", 
               "CXCL9", "IDO1", "IRGM1", "MPO", "MUC2", "MUC5AC", 
           "MYD88", "NCR1", "PRF1", "RETNLB", "SOCS1", "TICAM1", "TNF")

Genes_field   <- c("IFNy",  "CXCR3", "IL.6", #"GBP2", "IL.12", "IRG6",
                     "IL.10", "IL.13", "IL1RN",
                     "CXCR3", "CASP1", "CXCL9", 
                     "IDO1", "IRGM1", "MPO", "MUC2", "MUC5AC", "MYD88", 
                     "NCR1", "PRF1", "RETNLB", "SOCS1", "TICAM1", "TNF")
```

# Adding a variale that signifies if sample is infected or not

detection treshhold: delta ct = -5
(Jarquin Diaz et al)
 
```{r}
field <- field %>%
  mutate(infected_eimeria = 
           case_when(delta_ct_cewe_MminusE > -5 ~ "infected",
                     delta_ct_cewe_MminusE < -5 ~ "uninfected"))

lab <- lab %>%
  mutate(infected_eimeria = 
           case_when(delta > -5 ~ "infected",
                     delta < -5 ~ "uninfected"))


```

# Compare the differences in uninfected and infected data and field / lab

## Write a function which does a t test to quantify the differences of gene
## expression between uninfected and infected mice in the lab and field infections
## and also compares the uninfected lab and field and the infected lab and field 

```{r}
eimeria_t.test <- function(x, y) {
# select the uninfected (delta ct under -5 mice)  
  lab_uni <- lab %>%
    dplyr::filter(infected_eimeria == "uninfected")
# select the infected lab mice
  lab_inf <- lab %>% 
    dplyr::filter(infected_eimeria == "infected") 
# select the uninfected field mice (delta ct under -5 mice)  
  field_uni <- field %>%
    dplyr::filter(infected_eimeria == "uninfected")
# select the infected lab mice
  field_inf <- field %>% 
    dplyr::filter(infected_eimeria == "infected") 

print(c("Testing differences in expression in uninfected and infected lab mice. Gene:", toString(x)))
print(t.test(lab_uni %>% dplyr::select(all_of(x)), lab_inf %>% dplyr::select(all_of(x))))

print(c("Testing differences in expression in uninfected and infected field mice. Gene:", toString(x)))
print(t.test(field_uni %>% dplyr::select(all_of(x)), field_inf %>% dplyr::select(all_of(x))))

print(c("Testing differences in expression in uninfected lab vs field mice. Gene:", toString(x)))
print(t.test(lab_uni %>% dplyr::select(all_of(x)), field_uni %>% dplyr::select(all_of(x))))

print(c("Testing differences in expression in infected lab vs field mice. Gene:", toString(x)))
print(t.test(lab_inf %>% dplyr::select(all_of(x)), field_inf %>% dplyr::select(all_of(x))))

}


```

## 1. IFNy

```{r}
ggplot(lab, aes(x = delta, y = IFNy, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()


ggplot(field, aes(x = delta_ct_cewe_MminusE, y = IFNy, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

```{r}
ggplot(lab, aes(x = delta, y = IFNy, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = IFNy, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```


## 2. CXCR3

```{r}
ggplot(lab, aes(x = delta, y = CXCR3_bio, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", y = "CXCR3",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = CXCR3, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in 
       field samples") +
  theme_bw()


```

```{r}
ggplot(lab, aes(x = delta, y = CXCR3, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = CXCR3, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```


## 3. IL.6

```{r}
ggplot(lab, aes(x = delta, y = IL.6, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = IL.6, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()


```

## 4. IL.10

```{r}
ggplot(lab, aes(x = delta, y = IL.10, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = IL.10, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()


```


```{r}
ggplot(lab, aes(x = delta, y = IL.10, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = IL.10, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```


## 5. IL.13

```{r}
ggplot(lab, aes(x = delta, y = IL.13, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = IL.13, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()


```


```{r}
ggplot(lab, aes(x = delta, y = IL.13, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = IL.13, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 6. IL1RN

```{r}
ggplot(lab, aes(x = delta, y = IL1RN, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = IL1RN, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```


```{r}
ggplot(lab, aes(x = delta, y = IL1RN, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = IL1RN, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 7. CASP1

```{r}
ggplot(lab, aes(x = delta, y = CASP1, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = CASP1, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

```{r}
ggplot(lab, aes(x = delta, y = CASP1, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = CASP1, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 8. CXCL9

```{r}
ggplot(lab, aes(x = delta, y = CXCL9, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = CXCL9, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

```{r}
ggplot(lab, aes(x = delta, y = CXCL9, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = CXCL9, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 9. IDO1

```{r}
ggplot(lab, aes(x = delta, y = IDO1, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = IDO1, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```


```{r}
ggplot(lab, aes(x = delta, y = IDO1, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = IDO1, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 10. IRGM1

```{r}
ggplot(lab, aes(x = delta, y = IRGM1, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = IRGM1, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```


```{r}
ggplot(lab, aes(x = delta, y = IRGM1, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = IRGM1, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 11. MPO

```{r}
ggplot(lab, aes(x = delta, y = MPO, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = MPO, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

```{r}
ggplot(lab, aes(x = delta, y = MPO, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = MPO, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 12. MUC2

```{r}
ggplot(lab, aes(x = delta, y = MUC2, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = MUC2, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

```{r}
ggplot(lab, aes(x = delta, y = MUC2, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = MUC2, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 13. MUC5AC
```{r}
ggplot(lab, aes(x = delta, y = MUC5AC, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = MUC5AC, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```


```{r}
ggplot(lab, aes(x = delta, y = MUC5AC, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = MUC5AC, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 14. MYD88
```{r}
ggplot(lab, aes(x = delta, y = MYD88, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = MYD88, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

```{r}
ggplot(lab, aes(x = delta, y = MYD88, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = MYD88, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```
## 15. NCR1
```{r}
ggplot(lab, aes(x = delta, y = NCR1, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = NCR1, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

```{r}
ggplot(lab, aes(x = delta, y = NCR1, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = NCR1, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 16. PRF1
```{r}
ggplot(lab, aes(x = delta, y = PRF1, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = PRF1, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```
```{r}
ggplot(lab, aes(x = delta, y = PRF1, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = PRF1, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 17. RETNLB
```{r}
ggplot(lab, aes(x = delta, y = RETNLB, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = RETNLB, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

```{r}
ggplot(lab, aes(x = delta, y = RETNLB, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = RETNLB, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 18. SOCS1
```{r}
ggplot(lab, aes(x = delta, y = SOCS1, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = SOCS1, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```


```{r}
ggplot(lab, aes(x = delta, y = SOCS1, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = SOCS1, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 19. TICAM1
```{r}
ggplot(lab, aes(x = delta, y = TICAM1, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = TICAM1, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```


```{r}
ggplot(lab, aes(x = delta, y = TICAM1, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = TICAM1, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

## 20. TNF
```{r}
ggplot(lab, aes(x = delta, y = TNF, color = Parasite_challenge)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct", 
       title ="Immune gene expression against infection intensity 
       in lab infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = TNF, color = eimeriaSpecies)) +
  geom_jitter() +
  geom_abline() + 
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```


```{r}
ggplot(lab, aes(x = delta, y = TNF, color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in lab 
       infections") +
  theme_bw()



ggplot(field, aes(x = delta_ct_cewe_MminusE, y = TNF, 
                  color = infected_eimeria)) +
  geom_boxplot() +
  labs(x = "Infection intensity, dct",
       title ="Immune gene expression against infection intensity in field 
       samples") +
  theme_bw()

```

# Compare the differences in uninfected and infected data and field / lab

## Write a function which does a t test to quantify the differences of gene
## expression between uninfected and infected mice in the lab and field infections
## and also compares the uninfected lab and field and the infected lab and field 

```{r}
eimeria_t.test <- function(x) {
# select the uninfected (delta ct under -5 mice)  
  lab_uni <- lab %>%
    dplyr::filter(infected_eimeria == "uninfected")
# select the infected lab mice
  lab_inf <- lab %>% 
    dplyr::filter(infected_eimeria == "infected") 
# select the uninfected field mice (delta ct under -5 mice)  
  field_uni <- field %>%
    dplyr::filter(infected_eimeria == "uninfected")
# select the infected lab mice
  field_inf <- field %>% 
    dplyr::filter(infected_eimeria == "infected") 

print(c("Testing differences in expression in uninfected and infected lab mice. Gene:", toString(x)))
print(t.test(lab_uni %>% dplyr::select(all_of(x)), lab_inf %>% dplyr::select(all_of(x))))

print(c("Testing differences in expression in uninfected and infected field mice. Gene:", toString(x)))
print(t.test(field_uni %>% dplyr::select(all_of(x)), field_inf %>% dplyr::select(all_of(x))))

print(c("Testing differences in expression in uninfected lab vs field mice. Gene:", toString(x)))
print(t.test(lab_uni %>% dplyr::select(all_of(x)), field_uni %>% dplyr::select(all_of(x))))

print(c("Testing differences in expression in infected lab vs field mice. Gene:", toString(x)))
print(t.test(lab_inf %>% dplyr::select(all_of(x)), field_inf %>% dplyr::select(all_of(x))))

}


```

```{r}
print(lapply(intersect(Genes_field, Genes_lab), eimeria_t.test))
```


