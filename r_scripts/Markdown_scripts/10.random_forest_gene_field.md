---
title: "10. Applying random forest on field data - gene"
author: "Fay"
date: '2022-11-04'
output:
  pdf_document:
    keep_md: yes 
    fig_width: 12
    fig_height: 8
  html_document:
    df_print: paged
---



# Aim: 

- Applying the models established in the script: 
9
- How are hybrid mice different to the parental species?

#  Load necessary libraries:


```r
#install.packages("optimx", version = "2021-10.12") # this package is required for 
#the parasite load package to work
library(tidyverse)
library(tidyr)
library(dplyr)
library(cowplot)
library(randomForest)
library(ggplot2)
library(VIM) # visualizing missing data
library(mice) # imputing missing data without predictors
library(ggpubr)
library(optimx)
library(rfUtilities) # Implements a permutation test cross-validation for 
# Random Forests models
library(mice) #imputations
library(fitdistrplus) #testing distributions
library(logspline)
library(caret)
```

# Field data

## Import field data



```r
hm <- read.csv("output_data/2.imputed_MICE_data_set.csv")
```


## Clean data 


```r
Field <- hm %>%
  filter(origin == "Field") %>%
    drop_na(HI)
```

We have 1921 mice in total.


#### Prepare vectors for selecting


```r
EqPCR.cols      <- c("delta_ct_cewe_MminusE", "MC.Eimeria", "Ct.Eimeria") #,"Ct.Mus""delta_ct_ilwe_MminusE", )

Genes_wild   <- c("IFNy", "CXCR3", "IL.6", "IL.13", "IL.10", 
                  "IL1RN","CASP1", "CXCL9", "IDO1", "IRGM1", "MPO", 
                  "MUC2", "MUC5AC", "MYD88", "NCR1", "PRF1", "RETNLB", "SOCS1", 
                  "TICAM1", "TNF") #, "IL.12", "IRG6")
```


### Actual Cleaning


```r
#select the imputed gene columns
gene <-  Field %>%
  dplyr::select(c(Mouse_ID, "IFNy", "CXCR3", "IL.6", "IL.13", "IL.10", 
                  "IL1RN","CASP1", "CXCL9", "IDO1", "IRGM1", "MPO", 
                  "MUC2", "MUC5AC", "MYD88", "NCR1", "PRF1", "RETNLB", "SOCS1", 
                  "TICAM1", "TNF"))

genes <- gene %>%
  dplyr::select(-Mouse_ID)

#remove rows with only nas
genes <- genes[,colSums(is.na(genes))<nrow(genes)]

#remove colums with only nas 
genes <- genes[rowSums(is.na(genes)) != ncol(genes), ]

# select the same rows from the gene data
gene <- gene[row.names(genes),]

# select the same rows from the field data
Field <- Field[row.names(genes),]
```



# Predicting weight loss in our imputed field data

Start by making the predictions for the field data. 



```r
# load predicting weight loss model
weight_loss_predict <- readRDS("r_scripts/models/predict_WL.rds")

set.seed(540)


#The predict() function in R is used to predict the values based on the input data.
predictions_field <- predict(weight_loss_predict, genes)

#make the vector positive so that the distributions further down work
predictions_field <- predictions_field * (-1)

# assign test.data to a new object, so that we can make changes
result_field <- genes

#add the new variable of predictions to the result object
result_field <- cbind(result_field, predictions_field)

# add it to the field data 
Field <- cbind(Field, predictions_field)
```


# It is time to apply the package of Alice Balard et al. on our predictions!


Let's see if we indeed have differences across the hybrid index with our predicted 
weight loss. 

## Install the package


```
## 
## * checking for file ‘/tmp/Rtmp7QcQEB/remotes3cf301188cf1a5/alicebalard-parasiteLoad-1b43216/DESCRIPTION’ ... OK
## * preparing ‘parasiteLoad’:
## * checking DESCRIPTION meta-information ... OK
## * checking for LF line-endings in source and make files and shell scripts
## * checking for empty or unneeded directories
## * building ‘parasiteLoad_0.1.0.tar.gz’
```

## Data diagnostics

### Visualizations 

#### What is the distribution of the predicted weight loss?



```r
Field %>% ggplot(aes(x = predictions_field)) +
  geom_histogram(binwidth = 1.5)
```

![](10.random_forest_gene_field_files/figure-latex/unnamed-chunk-4-1.pdf)<!-- --> 


#### Rough graph of our predictions against the hybrid index and against the 
#### body length




```r
Field %>%
    ggplot(aes(x = HI , y = predictions_field , color = Sex)) +
    geom_smooth() +
    geom_point()
```

```
## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'
```

![](10.random_forest_gene_field_files/figure-latex/unnamed-chunk-5-1.pdf)<!-- --> 

```r
Field %>%
    ggplot(aes(x = Body_Length , y = predictions_field , color = Sex)) +
    geom_smooth() +
    geom_point()
```

```
## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'
```

```
## Warning: Removed 1 rows containing non-finite values (`stat_smooth()`).
```

```
## Warning: Removed 1 rows containing missing values (`geom_point()`).
```

![](10.random_forest_gene_field_files/figure-latex/unnamed-chunk-5-2.pdf)<!-- --> 




### Fitting distributions??

Ratios / Percentages are not normally distributed. Weibull is a good distributions. 

Alice used weibull for the qpcr data. (paper) 


```r
Field <- Field %>%
dplyr::mutate(WL = predictions_field)

x <- Field$WL

descdist(data = x, discrete = FALSE)
```

![](10.random_forest_gene_field_files/figure-latex/unnamed-chunk-6-1.pdf)<!-- --> 

```
## summary statistics
## ------
## min:  3.959833   max:  20.1775 
## median:  10.09201 
## mean:  10.3217 
## estimated sd:  2.516379 
## estimated skewness:  0.4392375 
## estimated kurtosis:  3.497443
```

```r
descdist(data = x, discrete = FALSE, #data is continuous
         boot = 1000)
```

![](10.random_forest_gene_field_files/figure-latex/unnamed-chunk-6-2.pdf)<!-- --> 

```
## summary statistics
## ------
## min:  3.959833   max:  20.1775 
## median:  10.09201 
## mean:  10.3217 
## estimated sd:  2.516379 
## estimated skewness:  0.4392375 
## estimated kurtosis:  3.497443
```

### Test for binomial distribution


```r
set.seed(10)
n = 25
size = 27
prob = .4
data = rbinom(x, size = size, prob = prob)
fit = fitdist(data = data, dist="binom", 
                   fix.arg=list(size = size), 
                   start=list(prob = 0.1))

summary(fit)
```

```
## Fitting of the distribution ' binom ' by maximum likelihood 
## Parameters : 
##      estimate  Std. Error
## prob 0.399558 0.005150141
## Fixed parameters:
##      value
## size    27
## Loglikelihood:  -779.317   AIC:  1560.634   BIC:  1564.448
```

```r
plot(fit)
```

![](10.random_forest_gene_field_files/figure-latex/unnamed-chunk-7-1.pdf)<!-- --> 


#### Functions for testing distributions

```r
normal_ <- fitdist(x, "norm")
weibull_ <- fitdist(x, "weibull")
gamma_ <- fitdist(x, "gamma")


# Define function to be used to test, get the log lik and aic
tryDistrib <- function(x, distrib){
  # deals with fitdistr error:
  fit <- tryCatch(MASS::fitdistr(x, distrib), error=function(err) "fit failed")
  return(list(fit = fit,
              loglik = tryCatch(fit$loglik, error=function(err) "no loglik computed"), 
              AIC = tryCatch(fit$aic, error=function(err) "no aic computed")))
}



findGoodDist <- function(x, distribs, distribs2){
  l =lapply(distribs, function(i) tryDistrib(x, i))
  names(l) <- distribs
  print(l)
  listDistr <- lapply(distribs2, function(i){
    if (i %in% "t"){
      fitdistrplus::fitdist(x, i, start = list(df =2))
    } else {
      fitdistrplus::fitdist(x,i)
    }}
  ) 
  par(mfrow=c(2,2))
  denscomp(listDistr, legendtext=distribs2)
  cdfcomp(listDistr, legendtext=distribs2)
  qqcomp(listDistr, legendtext=distribs2)
  ppcomp(listDistr, legendtext=distribs2)
  par(mfrow=c(1,1))
}
```



```r
tryDistrib(x, "normal")
```

```
## $fit
##       mean           sd     
##   10.32170304    2.51261999 
##  ( 0.13727909) ( 0.09707098)
## 
## $loglik
## [1] -783.9886
## 
## $AIC
## NULL
```

```r
tryDistrib(x, "binomial")
```

```
## $fit
## [1] "fit failed"
## 
## $loglik
## [1] "no loglik computed"
## 
## $AIC
## [1] "no aic computed"
```

```r
tryDistrib(x, "student")
```

```
## $fit
## [1] "fit failed"
## 
## $loglik
## [1] "no loglik computed"
## 
## $AIC
## [1] "no aic computed"
```

```r
tryDistrib(x, "weibull")
```

```
## Warning in densfun(x, parm[1], parm[2], ...): NaNs produced

## Warning in densfun(x, parm[1], parm[2], ...): NaNs produced
```

```
## $fit
##      shape        scale   
##    4.3023202   11.3019120 
##  ( 0.1703402) ( 0.1519404)
## 
## $loglik
## [1] -792.4037
## 
## $AIC
## NULL
```

```r
tryDistrib(x, "weibullshifted")
```

```
## $fit
## [1] "fit failed"
## 
## $loglik
## [1] "no loglik computed"
## 
## $AIC
## [1] "no aic computed"
```


```r
findGoodDist(x, "normal", "weibull")
```

```
## $normal
## $normal$fit
##       mean           sd     
##   10.32170304    2.51261999 
##  ( 0.13727909) ( 0.09707098)
## 
## $normal$loglik
## [1] -783.9886
## 
## $normal$AIC
## NULL
```

![](10.random_forest_gene_field_files/figure-latex/unnamed-chunk-10-1.pdf)<!-- --> 


```r
plot(normal_)
```

![](10.random_forest_gene_field_files/figure-latex/normal-1.pdf)<!-- --> 

```r
summary(normal_)
```

```
## Fitting of the distribution ' norm ' by maximum likelihood 
## Parameters : 
##      estimate Std. Error
## mean 10.32170 0.13727909
## sd    2.51262 0.09707091
## Loglikelihood:  -783.9886   AIC:  1571.977   BIC:  1579.606 
## Correlation matrix:
##      mean sd
## mean    1  0
## sd      0  1
```

```r
plot(gamma_)
```

![](10.random_forest_gene_field_files/figure-latex/normal-2.pdf)<!-- --> 

```r
summary(gamma_)
```

```
## Fitting of the distribution ' gamma ' by maximum likelihood 
## Parameters : 
##        estimate Std. Error
## shape 16.679232  1.2760602
## rate   1.615965  0.1255067
## Loglikelihood:  -779.1252   AIC:  1562.25   BIC:  1569.879 
## Correlation matrix:
##           shape      rate
## shape 1.0000000 0.9850536
## rate  0.9850536 1.0000000
```

```r
plot(weibull_)
```

![](10.random_forest_gene_field_files/figure-latex/normal-3.pdf)<!-- --> 

```r
summary(weibull_)
```

```
## Fitting of the distribution ' weibull ' by maximum likelihood 
## Parameters : 
##        estimate Std. Error
## shape  4.302738  0.1703492
## scale 11.301733  0.1519233
## Loglikelihood:  -792.4038   AIC:  1588.808   BIC:  1596.436 
## Correlation matrix:
##           shape     scale
## shape 1.0000000 0.3283846
## scale 0.3283846 1.0000000
```






### Is alpha significant for each hypothesis?




```r
Field$Sex <- as.factor(Field$Sex)


parasiteLoad::getParamBounds("normal", data = Field, response = "WL")
```

```
##      L1start         L1LB         L1UB      L2start         L2LB         L2UB 
## 10.321703036  3.959832716 20.177504703 10.321703036  3.959832716 20.177504703 
##   alphaStart      alphaLB      alphaUB    mysdStart       mysdLB       mysdUB 
##  0.000000000 -5.000000000  5.000000000  1.000000000  0.000000001 10.000000000
```

```r
speparam <- c(L1start = 10,
                     L1LB = 1e-9,
                     L1UB = 20,
                     L2start = 10,
                     L2LB = 1e-9,
                     L2UB = 20,
                     alphaStart = 0, alphaLB = -5, alphaUB = 5,
                     myshapeStart = 1, myshapeLB = 1e-9, myshapeUB = 5)

##All
fitWL_Sex <- parasiteLoad::analyse(data = Field,
                        response = "WL",
                        model = "normal",
                        group = "Sex")
```

```
## [1] "Analysing data for response: WL"
## [1] "Fit for the response: WL"
## [1] "Fitting for all"
## [1] "Fitting model basic without alpha"
## [1] "Did converge"
## [1] "Fitting model basic with alpha"
## [1] "Did converge"
## [1] "Fitting model advanced without alpha"
## [1] "Did converge"
## [1] "Fitting model advanced with alpha"
## [1] "Did converge"
## [1] "Fitting for groupA : F"
## [1] "Fitting model basic without alpha"
## [1] "Did converge"
## [1] "Fitting model basic with alpha"
## [1] "Did converge"
## [1] "Fitting model advanced without alpha"
## [1] "Did converge"
## [1] "Fitting model advanced with alpha"
## [1] "Did converge"
## [1] "Fitting for groupB : M"
## [1] "Fitting model basic without alpha"
## [1] "Did converge"
## [1] "Fitting model basic with alpha"
## [1] "Did converge"
## [1] "Fitting model advanced without alpha"
## [1] "Did converge"
## [1] "Fitting model advanced with alpha"
## [1] "Did converge"
## [1] "Testing H0 no alpha vs alpha"
##    dLL dDF     pvalue
## 1 2.63   1 0.02185549
## [1] "Testing H1 no alpha vs alpha"
##    dLL dDF     pvalue
## 1 2.01   1 0.04514727
## [1] "Testing H2 groupA no alpha vs alpha"
##    dLL dDF    pvalue
## 1 0.99   1 0.1592538
## [1] "Testing H2 groupB no alpha vs alpha"
##    dLL dDF     pvalue
## 1 1.81   1 0.05725558
## [1] "Testing H3 groupA no alpha vs alpha"
##    dLL dDF    pvalue
## 1 1.26   1 0.1130798
## [1] "Testing H3 groupB no alpha vs alpha"
##    dLL dDF     pvalue
## 1 1.82   1 0.05636448
## [1] "Testing H1 vs H0"
##    dLL dDF    pvalue
## 1 0.92   1 0.1756223
## [1] "Testing H2 vs H0"
##    dLL dDF    pvalue
## 1 2.09   3 0.2417575
## [1] "Testing H3 vs H1"
##    dLL dDF     pvalue
## 1 5.75   4 0.02147942
## [1] "Testing H3 vs H2"
##    dLL dDF     pvalue
## 1 4.57   2 0.01032858
```

```r
parasiteLoad::analyse(data = Field,
                        response = "WL",
                        model = "normal",
                        group = "Sex")
```

```
## [1] "Analysing data for response: WL"
## [1] "Fit for the response: WL"
## [1] "Fitting for all"
## [1] "Fitting model basic without alpha"
## [1] "Did converge"
## [1] "Fitting model basic with alpha"
## [1] "Did converge"
## [1] "Fitting model advanced without alpha"
## [1] "Did converge"
## [1] "Fitting model advanced with alpha"
## [1] "Did converge"
## [1] "Fitting for groupA : F"
## [1] "Fitting model basic without alpha"
## [1] "Did converge"
## [1] "Fitting model basic with alpha"
## [1] "Did converge"
## [1] "Fitting model advanced without alpha"
## [1] "Did converge"
## [1] "Fitting model advanced with alpha"
## [1] "Did converge"
## [1] "Fitting for groupB : M"
## [1] "Fitting model basic without alpha"
## [1] "Did converge"
## [1] "Fitting model basic with alpha"
## [1] "Did converge"
## [1] "Fitting model advanced without alpha"
## [1] "Did converge"
## [1] "Fitting model advanced with alpha"
## [1] "Did converge"
## [1] "Testing H0 no alpha vs alpha"
##    dLL dDF     pvalue
## 1 2.63   1 0.02185549
## [1] "Testing H1 no alpha vs alpha"
##    dLL dDF     pvalue
## 1 2.01   1 0.04514727
## [1] "Testing H2 groupA no alpha vs alpha"
##    dLL dDF    pvalue
## 1 0.99   1 0.1592538
## [1] "Testing H2 groupB no alpha vs alpha"
##    dLL dDF     pvalue
## 1 1.81   1 0.05725558
## [1] "Testing H3 groupA no alpha vs alpha"
##    dLL dDF    pvalue
## 1 1.26   1 0.1130798
## [1] "Testing H3 groupB no alpha vs alpha"
##    dLL dDF     pvalue
## 1 1.82   1 0.05636448
## [1] "Testing H1 vs H0"
##    dLL dDF    pvalue
## 1 0.92   1 0.1756223
## [1] "Testing H2 vs H0"
##    dLL dDF    pvalue
## 1 2.09   3 0.2417575
## [1] "Testing H3 vs H1"
##    dLL dDF     pvalue
## 1 5.75   4 0.02147942
## [1] "Testing H3 vs H2"
##    dLL dDF     pvalue
## 1 4.57   2 0.01032858
```

```
## $H0
## 
## Call:
## bbmle::mle2(minuslogl = response ~ dnorm(mean = MeanLoad(L1, 
##     L1, alpha, HI), sd = mysd), start = start, method = config$method, 
##     optimizer = config$optimizer, data = data, lower = c(L1 = paramBounds[["L1LB"]], 
##         mysd = paramBounds[["mysdLB"]], alpha = paramBounds[["alphaLB"]]), 
##     upper = c(L1 = paramBounds[["L1UB"]], mysd = paramBounds[["mysdUB"]], 
##         alpha = paramBounds[["alphaUB"]]), control = config$control)
## 
## Coefficients:
##         L1       mysd      alpha 
##  9.7996797  2.4929816 -0.2305268 
## 
## Log-likelihood: -781.36 
## Best method: bobyqa 
## 
## $H1
## 
## Call:
## bbmle::mle2(minuslogl = response ~ dnorm(mean = MeanLoad(L1, 
##     L2, alpha, HI), sd = mysd), start = start, method = config$method, 
##     optimizer = config$optimizer, data = data, lower = c(L1 = paramBounds[["L1LB"]], 
##         mysd = paramBounds[["mysdLB"]], L2 = paramBounds[["L2LB"]], 
##         alpha = paramBounds[["alphaLB"]]), upper = c(L1 = paramBounds[["L1UB"]], 
##         mysd = paramBounds[["mysdUB"]], L2 = paramBounds[["L2UB"]], 
##         alpha = paramBounds[["alphaUB"]]), control = config$control)
## 
## Coefficients:
##        L1        L2     alpha      mysd 
##  9.564795 10.071590 -0.204059  2.486166 
## 
## Log-likelihood: -780.44 
## Best method: bobyqa 
## 
## $H2
## $H2$groupA
## 
## Call:
## bbmle::mle2(minuslogl = response ~ dnorm(mean = MeanLoad(L1, 
##     L1, alpha, HI), sd = mysd), start = start, method = config$method, 
##     optimizer = config$optimizer, data = data, lower = c(L1 = paramBounds[["L1LB"]], 
##         mysd = paramBounds[["mysdLB"]], alpha = paramBounds[["alphaLB"]]), 
##     upper = c(L1 = paramBounds[["L1UB"]], mysd = paramBounds[["mysdUB"]], 
##         alpha = paramBounds[["alphaUB"]]), control = config$control)
## 
## Coefficients:
##         L1       mysd      alpha 
## 10.0350054  2.6318415 -0.1997412 
## 
## Log-likelihood: -398.57 
## Best method: bobyqa 
## 
## $H2$groupB
## 
## Call:
## bbmle::mle2(minuslogl = response ~ dnorm(mean = MeanLoad(L1, 
##     L1, alpha, HI), sd = mysd), start = start, method = config$method, 
##     optimizer = config$optimizer, data = data, lower = c(L1 = paramBounds[["L1LB"]], 
##         mysd = paramBounds[["mysdLB"]], alpha = paramBounds[["alphaLB"]]), 
##     upper = c(L1 = paramBounds[["L1UB"]], mysd = paramBounds[["mysdUB"]], 
##         alpha = paramBounds[["alphaUB"]]), control = config$control)
## 
## Coefficients:
##         L1       mysd      alpha 
##  9.5523403  2.3329417 -0.2688342 
## 
## Log-likelihood: -380.7 
## Best method: bobyqa 
## 
## 
## $H3
## $H3$groupA
## 
## Call:
## bbmle::mle2(minuslogl = response ~ dnorm(mean = MeanLoad(L1, 
##     L2, alpha, HI), sd = mysd), start = start, method = config$method, 
##     optimizer = config$optimizer, data = data, lower = c(L1 = paramBounds[["L1LB"]], 
##         mysd = paramBounds[["mysdLB"]], L2 = paramBounds[["L2LB"]], 
##         alpha = paramBounds[["alphaLB"]]), upper = c(L1 = paramBounds[["L1UB"]], 
##         mysd = paramBounds[["mysdUB"]], L2 = paramBounds[["L2UB"]], 
##         alpha = paramBounds[["alphaUB"]]), control = config$control)
## 
## Coefficients:
##         L1         L2      alpha       mysd 
## 10.1934433  9.7543876 -0.2423411  2.6273997 
## 
## Log-likelihood: -398.28 
## Best method: bobyqa 
## 
## $H3$groupB
## 
## Call:
## bbmle::mle2(minuslogl = response ~ dnorm(mean = MeanLoad(L1, 
##     L2, alpha, HI), sd = mysd), start = start, method = config$method, 
##     optimizer = config$optimizer, data = data, lower = c(L1 = paramBounds[["L1LB"]], 
##         mysd = paramBounds[["mysdLB"]], L2 = paramBounds[["L2LB"]], 
##         alpha = paramBounds[["alphaLB"]]), upper = c(L1 = paramBounds[["L1UB"]], 
##         mysd = paramBounds[["mysdUB"]], L2 = paramBounds[["L2UB"]], 
##         alpha = paramBounds[["alphaUB"]]), control = config$control)
## 
## Coefficients:
##         L1         L2      alpha       mysd 
##  8.7485937 10.1460223 -0.2653402  2.2741121 
## 
## Log-likelihood: -376.41 
## Best method: bobyqa
```

```r
plot_WL_Sex<- bananaPlot(mod = fitWL_Sex$H3,
             data = Field,
             response = "WL",
             group = "Sex") +
    scale_fill_manual(values = c("blueviolet", "limegreen")) +
  scale_color_manual(values = c("blueviolet", "limegreen")) +
  theme_bw() 
```

```
## Scale for fill is already present.
## Adding another scale for fill, which will replace the existing scale.
## Scale for colour is already present.
## Adding another scale for colour, which will replace the existing scale.
```

```r
# Create HI bar
HIgradientBar <- ggplot(data.frame(hi = seq(0,1,0.0001)),
                        aes(x=hi, y=1, fill = hi)) +
  geom_tile() +
  theme_void() +
  scale_fill_gradient(low = "blue", high = "red")  + 
  scale_x_continuous(expand=c(.01,0)) + 
  scale_y_continuous(expand=c(0,0)) +
  theme(legend.position = 'none')

plot_grid(plot_WL_Sex, 
          HIgradientBar,
          nrow = 2,
          align = "v",
          axis = "tlr",
          rel_heights = c(13, 1))
```

![](10.random_forest_gene_field_files/figure-latex/unnamed-chunk-11-1.pdf)<!-- --> 

```r
plot_WL_Sex
```

![](10.random_forest_gene_field_files/figure-latex/unnamed-chunk-11-2.pdf)<!-- --> 

H0: the expected load for the subspecies and between 2 groups is the same

H1: the mean load across 2 groups is the same, but can differ across subspecies

H2: the mean load across subspecies is the same, but can differ between the 
2 groups

H3: the mean load can differ both across subspecies and between 2 groups




```r
ggplot(data = Field, aes(x = delta_ct_cewe_MminusE, y = WL)) +
  geom_point() +
  stat_smooth(method= "lm") 
```

```
## `geom_smooth()` using formula = 'y ~ x'
```

```
## Warning: Removed 150 rows containing non-finite values (`stat_smooth()`).
```

```
## Warning: Removed 150 rows containing missing values (`geom_point()`).
```

![](10.random_forest_gene_field_files/figure-latex/unnamed-chunk-12-1.pdf)<!-- --> 

```r
Field2 <- Field %>%
  drop_na(delta_ct_cewe_MminusE)

cor(Field2$WL, Field2$delta_ct_cewe_MminusE)
```

```
## [1] 0.1576532
```

```r
tolerance <- lm(WL ~  delta_ct_cewe_MminusE, data = Field)


summary(tolerance)
```

```
## 
## Call:
## lm(formula = WL ~ delta_ct_cewe_MminusE, data = Field)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.2762 -1.8206 -0.3349  1.6904  8.7213 
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(>|t|)    
## (Intercept)           10.91325    0.45066   24.22   <2e-16 ***
## delta_ct_cewe_MminusE  0.11288    0.05227    2.16   0.0321 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.341 on 183 degrees of freedom
##   (150 observations deleted due to missingness)
## Multiple R-squared:  0.02485,	Adjusted R-squared:  0.01953 
## F-statistic: 4.664 on 1 and 183 DF,  p-value: 0.0321
```

```r
confint(tolerance)
```

```
##                              2.5 %    97.5 %
## (Intercept)           10.024092567 11.802405
## delta_ct_cewe_MminusE  0.009757681  0.216005
```



```r
ggplot(data = Field, aes(x = OPG, y = WL)) +
  geom_point() +
  stat_smooth(method= "lm") +
  scale_x_log10()
```

```
## Warning: Transformation introduced infinite values in continuous x-axis
## Transformation introduced infinite values in continuous x-axis
```

```
## `geom_smooth()` using formula = 'y ~ x'
```

```
## Warning: Removed 280 rows containing non-finite values (`stat_smooth()`).
```

```
## Warning: Removed 157 rows containing missing values (`geom_point()`).
```

![](10.random_forest_gene_field_files/figure-latex/unnamed-chunk-13-1.pdf)<!-- --> 

```r
Field2 <- Field %>%
  drop_na(OPG)

cor(Field2$WL, Field2$OPG)
```

```
## [1] 0.08025742
```

```r
tolerance <- lm(WL ~  OPG, data = Field)


summary(tolerance)
```

```
## 
## Call:
## lm(formula = WL ~ OPG, data = Field)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -6.5452 -1.9797 -0.0749  1.7505  9.6588 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 1.051e+01  2.012e-01  52.225   <2e-16 ***
## OPG         3.732e-08  3.493e-08   1.068    0.287    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.65 on 176 degrees of freedom
##   (157 observations deleted due to missingness)
## Multiple R-squared:  0.006441,	Adjusted R-squared:  0.000796 
## F-statistic: 1.141 on 1 and 176 DF,  p-value: 0.2869
```

```r
confint(tolerance)
```

```
##                     2.5 %       97.5 %
## (Intercept)  1.010806e+01 1.090201e+01
## OPG         -3.162786e-08 1.062601e-07
```


```r
tolerance <- lm(WL ~  OPG * delta_ct_cewe_MminusE, data = Field)


summary(tolerance)
```

```
## 
## Call:
## lm(formula = WL ~ OPG * delta_ct_cewe_MminusE, data = Field)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.6452 -1.9629 -0.4451  1.4172  8.6849 
## 
## Coefficients:
##                             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)                1.146e+01  9.024e-01  12.699   <2e-16 ***
## OPG                       -1.183e-05  2.335e-05  -0.506    0.615    
## delta_ct_cewe_MminusE      1.787e-01  1.181e-01   1.512    0.137    
## OPG:delta_ct_cewe_MminusE  5.325e-06  6.842e-06   0.778    0.440    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.571 on 45 degrees of freedom
##   (286 observations deleted due to missingness)
## Multiple R-squared:  0.07703,	Adjusted R-squared:  0.0155 
## F-statistic: 1.252 on 3 and 45 DF,  p-value: 0.3023
```

```r
confint(tolerance)
```

```
##                                   2.5 %       97.5 %
## (Intercept)                9.641497e+00 1.327639e+01
## OPG                       -5.885891e-05 3.520486e-05
## delta_ct_cewe_MminusE     -5.927564e-02 4.166351e-01
## OPG:delta_ct_cewe_MminusE -8.455062e-06 1.910478e-05
```





```r
Field <- Field %>%
  dplyr::mutate(BMI = Body_Weight / Body_Length)

ggplot(data = Field, aes(x = BMI, y = WL)) +
  geom_point() +
  stat_smooth(method= "lm") 
```

```
## `geom_smooth()` using formula = 'y ~ x'
```

```
## Warning: Removed 1 rows containing non-finite values (`stat_smooth()`).
```

```
## Warning: Removed 1 rows containing missing values (`geom_point()`).
```

![](10.random_forest_gene_field_files/figure-latex/unnamed-chunk-15-1.pdf)<!-- --> 

```r
bmi <- lm(WL ~ BMI, data = Field)

cor(Field$BMI, Field$WL, use = "complete.obs")
```

```
## [1] -0.1138541
```

```r
summary(bmi)
```

```
## 
## Call:
## lm(formula = WL ~ BMI, data = Field)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.8747 -1.8728 -0.0796  1.7947 10.0742 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  11.6905     0.6707  17.431   <2e-16 ***
## BMI          -7.3938     3.5409  -2.088   0.0376 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.507 on 332 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.01296,	Adjusted R-squared:  0.00999 
## F-statistic:  4.36 on 1 and 332 DF,  p-value: 0.03755
```

```r
confint(bmi)
```

```
##                 2.5 %     97.5 %
## (Intercept)  10.37122 13.0098096
## BMI         -14.35928 -0.4283224
```

