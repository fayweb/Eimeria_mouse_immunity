---
title: "Challenge infections - Descreptive statistics"
output:
  html_document: default
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#### Challenge infections with *Eimeria*. Here I am presenting some summary statistics on the laboratory infection of mice with different *Eimeria* strains.


```{r, include=FALSE}
## Load the required libraries
library(dplyr)
library(tidyverse)
library(tibble)
```

Here is a data frame containing all information derived from the experimental infections
with *Eimeria*.
```{r}
#### Read the file
CI <- read.csv("https://raw.githubusercontent.com/derele/Eimeria_Lab/master/data_products/Challenge_infections.csv")
```

###  Wrangling
```{r, echo = FALSE}
tibble::as_tibble(CI)
```
Let's add a column with the parasite names 
```{r, echo = FALSE}
CI <- CI %>%
  dplyr::mutate(Parasite_primary = case_when(
    primary_infection == "E64" ~ "Eimeria ferrisi",
    primary_infection == "E88" ~ "Eimeria falciformis",
    primary_infection == "Eflab" ~ "Eimeria falciformis",
    primary_infection == "E139" ~ "Eimeria ferrisi",
    primary_infection == "UNI" ~ "uninfected",
    TRUE ~ ""))
    
    
CI <- CI %>%
  dplyr::mutate(Parasite_challenge = case_when(    
    challenge_infection == "E64" ~ "Eimeria ferrisi",
    challenge_infection == "E88" ~ "Eimeria falciformis",
    challenge_infection == "Eflab" ~ "E. falciformis",
    challenge_infection == "E139" ~ "Eimeria ferrisi",
    challenge_infection == "UNI" ~ "uninfected",
    TRUE ~ ""))
```


### Summary statistics on experimental design

#### Summarizing data by each mouse

```{r, echo = FALSE, warning=FALSE, message=FALSE, error=FALSE}
CIMouse <- CI  %>%
  dplyr::group_by(EH_ID, infection) %>%  
  summarise(max_OOC = max(OOC, na.rm = TRUE),
            max_WL = min(relative_weight, na.rm = TRUE),
            experiment = unique(experiment),
            mouse_strain = unique(mouse_strain),
            primary_infection = unique(primary_infection),
            challenge_infection =unique(challenge_infection),
            infection_history=unique(infection_history),
            infection = unique(infection),
            experiment=unique(experiment),
            hybrid_status = unique(hybrid_status),
            death = unique(death),
            Parasite_primary = unique(Parasite_primary),
            Parasite_challenge = unique(Parasite_challenge))


```

#### How many mice do we have in each infection ? (primary or challenge infection)
```{r, echo = FALSE}
CIMouse %>% 
  group_by(infection) %>%
  dplyr::summarise(total_mice = length(EH_ID))
```
####  How many experiments do we have? How many mice are in each experiment?
```{r, echo = FALSE}
CIMouse %>% 
  group_by(experiment) %>%
  dplyr::summarise(total_mice = length(EH_ID))
```
#### How many mouse strains do we have? 

We here use four wild-derived inbred mouse strains. from these mouse strains F1 
hybrids were generated. 

Two parental strains represented M. m. domesticus: 
  - SCHUNT (Locality: Schweben, Hessen, Germany [N: 5°0 26′, E: 9°36′] (Martincová et al., 2019))  
  - STRA (Locality: Straas, Bavaria, Germany [N: 50°11′, E: 11°46′] (Piálek et al., 2008), 
Two parental strains represented M. m. musculus: 
  - BUSNA (Locality: Buškovice, Bohemia, Czech Republic [N: 5°0 14′, E: 1°3 22′] (Piálek et al., 2008))
  - PWD (Locality: Kunratice, Bohemia, Czech Republic [N: 5°0 01′, E: 14 2°9′] (Gregorová & Forejt, 2000))

```{r, echo = FALSE}
CIMouse %>%
  group_by(mouse_strain, hybrid_status) %>%
  dplyr::summarise(total_mice = length(EH_ID))

#now only show the hybrid status
CIMouse %>% 
  group_by(hybrid_status) %>%
  dplyr::summarise(total_mice = length(EH_ID))
  
```
####  Which Eimeria strains were used?
The three parasite isolates used in this study were isolated from feces of three different M. m. domesticus/M. m. musculus hybrid mice captured in Brandenburg, Germany, in 2016 (capture permit No. 2347/35/2014). The parasite isolates belong to both the most prevalent Eimeria species in this area, namely E. ferrisi (isolate Brandenburg64) and E. falciformis (isolate Brandenburg88)(Jarquín-Díaz et al., 2019). Isolate Brandenburg64 was isolated in a 92% M. m. domesticus individual (hybrid index (HI) = 0.08: Proportion of M. m. musculus alleles in a set of 14 diagnostic markers, see Balard et al. (2020)) and isolate Brandenburg88 in a 80% M. m. domesticus (HI = 0.2).

Prepatency and the peak day of parasite shedding for these isolates were estimated during infection in NMRI laboratory mice (Al-khlifeh et al., 2019) which were also used for serial passaging of the isolates. Previous to the experiment, the isolates had been passaged, respectively, 3 and 4 times in NMRI laboratory mice. Parasite infective forms (oocysts) were recovered by flotation in saturated NaCl solution followed by washing and observation under light microscope (following the protocol described in Clerc et al. (2019)) and stored at room temperature in 1 ml of 2% potassium dichromate for a maximum of 2 months before infection of the wild-derived mice. Oocysts were allowed to sporulate 10 days before infection in a water bath at 30°C

1. Primary:
```{r, echo = FALSE}
CIMouse %>% 
  filter(infection == "primary") %>%
  group_by(Parasite_primary)  %>%
  dplyr::summarise(total_mice = length(EH_ID)) 

```

2. Further, for the challenge infections

```{r, echo = FALSE}
CIMouse %>% 
  filter(infection == "challenge") %>%
  group_by(Parasite_challenge)  %>%
  dplyr::summarise(total_mice = length(EH_ID)) 
```

#### 2.6 How many mice died in each infection?
```{r, echo = FALSE}
CIMouse %>% 
  group_by(death) %>%
  dplyr::summarise(length(EH_ID)) 
```
#### 2.6.1 From the mice that died in the primary infection, what was the infection status?

```{r, echo = FALSE}
CIMouse %>%
  filter(death == "primary", infection == "primary") %>%
  group_by(Parasite_primary) %>%
  dplyr::summarise(total_mice = length(EH_ID))
```
Most of the mice dying in the first infections are infected with Eimeria falciformis.

### 3 Summary statistics - Resistance/ Tolerance proxies
  
#### 3.1 What is the avarege maximum oocysts output for each mouse in the primary and challenge infections?

1. Visualizing the primary infections
`
```{r}
CIMouse %>%
    filter(infection == "primary")  %>%
  ggplot(aes(max_OOC, color = Parasite_primary, fill = Parasite_primary)) +
  geom_histogram(bins = 30, alpha = 0.5) +
  labs(x = "Oocysts at day of maximal shedding", y = "Number of mice",
       title = "Maximum oocyst shedding per mouse, primary infections") +
    theme_bw()

CIMouse  %>%
    filter(infection == "primary")  %>%
  ggplot(aes(x = Parasite_primary, y = max_OOC, fill = Parasite_primary)) +
  geom_boxplot() +
    theme_bw()

CIMouse  %>%
    filter(infection == "primary")  %>%
  ggplot(aes(x = Parasite_primary, y = max_OOC, fill = Parasite_primary)) +
  geom_violin() +
    theme_bw() 

CIMouse  %>%
    filter(infection == "primary", !Parasite_primary == "uninfected")  %>%
  ggplot(aes(x = Parasite_primary, y = max_OOC, fill = Parasite_primary)) +
  geom_violin(alpha = 0.5) +
    geom_line() +
     stat_summary(fun.y = "median", geom = "point", size = 3) +
    theme_bw() 

CIMouse  %>%
    filter(infection == "primary", !Parasite_primary == "uninfected")  %>%
  ggplot(aes(x = Parasite_primary, y = max_OOC, fill = Parasite_primary)) +
  geom_violin(alpha = 0.5) +
    geom_line() +
     stat_summary(fun.y = "median", geom = "point", size = 3) +
    theme_bw() 
```

2. And the challenge infections
```{r}
CIMouse %>%
    filter(infection == "challenge")  %>%
  ggplot(aes(max_OOC, color = Parasite_challenge, fill = Parasite_challenge)) +
  geom_histogram(bins = 30, alpha = 0.5) +
  labs(x = "Oocysts at day of maximal shedding", y = "Number of mice",
       title = "Maximum oocyst shedding per mouse, challenge infections") +
    theme_bw()

CIMouse  %>%
    filter(infection == "challenge")  %>%
  ggplot(aes(x = Parasite_challenge, y = max_OOC, fill = Parasite_challenge)) +
  geom_boxplot() +
    theme_bw()

CIMouse  %>%
    filter(infection == "challenge")  %>%
  ggplot(aes(x = Parasite_challenge, y = max_OOC, fill = Parasite_challenge)) +
  geom_violin() +
    theme_bw() 

CIMouse  %>%
    filter(infection == "challenge", !Parasite_challenge == "uninfected")  %>%
  ggplot(aes(x = Parasite_challenge, y = max_OOC, fill = Parasite_challenge)) +
  geom_violin(alpha = 0.5) +
    geom_line() +
     stat_summary(fun.y = "median", geom = "point", size = 3) +
    theme_bw() 
```


#### maximum oocysts output for each mouse strain in each infection?

1. primary infections:
```{r, echo = FALSE}
CIMouse  %>%
    filter(infection == "primary")  %>%
  ggplot(aes(x = Parasite_primary, y = max_OOC, fill = Parasite_primary)) +
  geom_boxplot() +
    theme_bw() + 
    facet_wrap(~ hybrid_status)
```

2. Challenge infections:
```{r, echo = FALSE}
CIMouse  %>%
    filter(infection == "challenge")  %>%
  ggplot(aes(y = max_OOC, fill = Parasite_challenge)) +
  geom_boxplot() +
    theme_bw() + 
    facet_wrap(~ hybrid_status)
```
Effect of experiments on oocyst shedding?

1. primary infections:
```{r, echo = FALSE}
CIMouse  %>%
    filter(infection == "primary")  %>%
  ggplot(aes(y = max_OOC, fill = Parasite_primary)) +
  geom_boxplot() +
    theme_bw() + 
    facet_wrap(~ experiment)
```

2. Challenge infections:
```{r, echo = FALSE}
CIMouse  %>%
    filter(infection == "challenge")  %>%
  ggplot(aes(y = max_OOC, fill = Parasite_challenge)) +
  geom_boxplot() +
    theme_bw() + 
    facet_wrap(~ experiment)
```
Patency in primary infections

```{r}
CI %>%
  group_by("EH_ID") %>%
  filter(infection == "primary") %>%
  ggplot(aes(x = dpi, y = OOC, color = Parasite_primary)) +
  geom_point(position = position_jitterdodge()) +
  labs(x = "Days Post Infection", y = "Oocysts per gram",
       title = "Oocyst shedding in primary infections during the 
       course of infection") +
    theme_bw() 
```

Patency in primary infections - experiments
```{r}
CI %>%
  group_by("EH_ID") %>%
  filter(infection == "primary") %>%
  ggplot(aes(x = dpi, y = OOC, color = Parasite_primary)) +
  geom_point(position = position_jitterdodge()) +
  labs(x = "Days Post Infection", y = "Oocysts per gram",
       title = "Oocyst shedding in primary infections during the 
       course of infection") +
    theme_bw() +
    stat_smooth() +
    facet_wrap(~ experiment)
```
Patency in primary infections - mouse strains
```{r}
CI %>%
  group_by("EH_ID") %>%
  filter(infection == "primary") %>%
  ggplot(aes(x = dpi, y = OOC, color = Parasite_primary)) +
  geom_point(position = position_jitterdodge()) +
  labs(x = "Days Post Infection", y = "Oocysts per gram",
       title = "Oocyst shedding in primary infections during the 
       course of infection") +
    theme_bw() +
    facet_wrap(~ hybrid_status)
```
Patency in challenge infections - experiments
```{r}
CI %>%
  group_by("EH_ID") %>%
  filter(infection == "challenge") %>%
  ggplot(aes(x = dpi, y = OOC, color = Parasite_challenge)) +
  geom_point(position = position_jitterdodge()) +
  labs(x = "Days Post Infection", y = "Oocysts per gram",
       title = "Oocyst shedding in challenge infections during the 
       course of infection") +
    theme_bw() +
    facet_wrap(~ experiment)
```
Patency in challenge infections - mouse strains
```{r}
CI %>%
  group_by("EH_ID") %>%
  filter(infection == "challenge") %>%
  ggplot(aes(x = dpi, y = OOC, color = Parasite_challenge)) +
  geom_point(position = position_jitterdodge()) +
  labs(x = "Days Post Infection", y = "Oocysts per gram",
       title = "Oocyst shedding in challenge infections during the 
       course of infection") +
    theme_bw() +
    facet_wrap(~ hybrid_status)
```




##########################################################################
#### What is the average max weight loss output for each mouse in the primary and challenge infections?

1. Visualizing the primary infections
`
```{r}
CIMouse %>%
    dplyr::filter(infection == "primary") %>%
  ggplot(aes(max_WL, color = Parasite_primary, fill = Parasite_primary)) +
  geom_histogram(bins = 30, alpha = 0.5)  +
    theme_bw()

CIMouse  %>%
    filter(infection == "primary")  %>%
  ggplot(aes(x = Parasite_primary, y = max_WL, fill = Parasite_primary)) +
  geom_boxplot() +
    theme_bw()


CIMouse  %>%
    filter(infection == "primary")  %>%
  ggplot(aes(x = Parasite_primary, y = max_WL, fill = Parasite_primary)) +
  geom_violin(alpha = 0.5) +
    geom_line() +
     stat_summary(fun.y = "median", geom = "point", size = 3) +
    theme_bw() 


```

2. And the challenge infections
```{r}
CIMouse %>%
    filter(infection == "challenge")  %>%
  ggplot(aes(max_WL, color = Parasite_challenge, fill = Parasite_challenge)) +
  geom_histogram(bins = 30, alpha = 0.5) +
    theme_bw()

CIMouse  %>%
    filter(infection == "challenge")  %>%
  ggplot(aes(x = Parasite_challenge, y = max_WL, fill = Parasite_challenge)) +
  geom_boxplot() +
    theme_bw()

CIMouse  %>%
    filter(infection == "challenge")  %>%
  ggplot(aes(x = Parasite_challenge, y = max_WL, fill = Parasite_challenge)) +
  geom_violin(alpha = 0.5) +
    geom_line() +
     stat_summary(fun.y = "median", geom = "point", size = 3) +
    theme_bw() 
```


#### maximum weight loss output for each mouse strain in each infection?

1. primary infections:
```{r, echo = FALSE}
CIMouse  %>%
    filter(infection == "primary")  %>%
  ggplot(aes(y = max_WL, fill = Parasite_primary)) +
  geom_boxplot() +
    theme_bw() + 
    facet_wrap(~ hybrid_status)
```

2. Challenge infections:
```{r, echo = FALSE}
CIMouse  %>%
    filter(infection == "challenge")  %>%
  ggplot(aes(, y = max_WL, fill = Parasite_challenge)) +
  geom_boxplot() +
    theme_bw() + 
    facet_wrap(~ hybrid_status)
```
Effect of experiments on weight loss?

1. primary infections:
```{r, echo = FALSE}
CIMouse  %>%
    filter(infection == "primary")  %>%
  ggplot(aes(y = max_WL, fill = Parasite_primary)) +
  geom_boxplot() +
    theme_bw() + 
    facet_wrap(~ experiment)
```
Weight changes during the course of infection
1. Primary
```{r}
CI %>% 
    filter(infection == "primary") %>%
    drop_na(weight_dpi0, relative_weight) %>%
    group_by("EH_ID") %>%
    ggplot(aes(x = dpi, y = relative_weight, color = Parasite_primary)) +
    geom_jitter() +
    stat_smooth() +
    labs(x = "Days Post Infection", y = "Relative weight to first day",
         title = "Weight changes during the course of the primary infection") +
    theme_bw()

CI %>% 
    filter(infection == "primary") %>%
    drop_na(weight_dpi0, relative_weight) %>%
    group_by("EH_ID") %>%
    ggplot(aes(x = dpi, y = relative_weight, color = Parasite_primary)) +
    geom_jitter() +
    stat_smooth() +
    facet_wrap(~ mouse_strain) +
    labs(x = "Days Post Infection", y = "Relative weight to first day",
         title = "Weight changes during the course of the primary infection") +
    theme_bw()

CI %>% 
    filter(infection == "primary") %>%
    drop_na(weight_dpi0, relative_weight) %>%
    group_by("EH_ID") %>%
    ggplot(aes(x = dpi, y = relative_weight, color = Parasite_primary)) +
    geom_jitter() +
    stat_smooth() +
    facet_wrap(~ experiment) +
    labs(x = "Days Post Infection", y = "Relative weight to first day",
         title = "Weight changes during the course of the primary infection") +
    theme_bw()

```
Weight changes during the course of infection
1. challenge
```{r}
CI %>% 
    filter(infection == "challenge") %>%
    drop_na(weight_dpi0, relative_weight) %>%
    group_by("EH_ID") %>%
    ggplot(aes(x = dpi, y = relative_weight, color = Parasite_challenge)) +
    geom_jitter() +
    stat_smooth() +
    labs(x = "Days Post Infection", y = "Relative weight to first day",
         title = "Weight changes during the course of the challenge infection") +
    theme_bw()

CI %>% 
    filter(infection == "challenge") %>%
    drop_na(weight_dpi0, relative_weight) %>%
    group_by("EH_ID") %>%
    ggplot(aes(x = dpi, y = relative_weight, color = Parasite_challenge)) +
    geom_jitter() +
    stat_smooth() +
    facet_wrap(~ mouse_strain) +
    labs(x = "Days Post Infection", y = "Relative weight to first day",
         title = "Weight changes during the course of the challenge infection") +
    theme_bw()

CI %>% 
    filter(infection == "challenge") %>%
    drop_na(weight_dpi0, relative_weight) %>%
    group_by("EH_ID") %>%
    ggplot(aes(x = dpi, y = relative_weight, color = Parasite_challenge)) +
    geom_jitter() +
    stat_smooth() +
    facet_wrap(~ experiment) +
    labs(x = "Days Post Infection", y = "Relative weight to first day",
         title = "Weight changes during the course of the challenge infection") +
    theme_bw()

```

Tissue infection intensity vs max weight loss - primary
```{r}
CI  %>%
  group_by("EH_ID") %>%
  filter(infection == "primary", Eim_MC == "TRUE") %>%
  ggplot(aes(x = delta, y = max_WL, color = Parasite_primary)) +
  geom_jitter() +
  labs(x = "Delta Ct, Infection intensity", y = "Maximum weight loss of each mouse",
       title = "Maximum Weight loss for each mouse and infection intensity, 
       primary infections") +
    geom_smooth(method = "lm") +
    theme_bw()

CI  %>%
  group_by("EH_ID") %>%
  filter(infection == "primary", Eim_MC == "TRUE") %>%
  ggplot(aes(x = delta, y = max_WL, color = Parasite_primary)) +
  geom_jitter() +
  labs(x = "Delta Ct, Infection intensity", y = "Maximum weight loss of each mouse",
       title = "Maximum Weight loss for each mouse and infection intensity, 
       primary infections") +
    geom_smooth(method = "lm") +
    theme_bw() +
    facet_wrap(~experiment)
```

Tissue infection intensity vs max weight loss - challenge
```{r}
CI  %>%
  group_by("EH_ID") %>%
  filter(infection == "challenge", Eim_MC == "TRUE") %>%
  ggplot(aes(x = delta, y = max_WL, color = Parasite_challenge)) +
  geom_jitter() +
  labs(x = "Delta Ct, Infection intensity", y = "Maximum weight loss of each mouse",
       title = "Maximum Weight loss for each mouse and infection intensity, 
       challenge infections") +
    geom_smooth(method = "lm") +
    theme_bw()

CI  %>%
  group_by("EH_ID") %>%
  filter(infection == "challenge", Eim_MC == "TRUE") %>%
  ggplot(aes(x = delta, y = max_WL, color = Parasite_challenge)) +
  geom_jitter() +
  labs(x = "Delta Ct, Infection intensity", y = "Maximum weight loss of each mouse",
       title = "Maximum Weight loss for each mouse and infection intensity, 
       challenge infections") +
    geom_smooth(method = "lm") +
    theme_bw()  +
    facet_wrap(~experiment)
```

